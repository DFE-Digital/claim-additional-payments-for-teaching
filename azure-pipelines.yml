pr:
  branches:
    include:
    - '*'

trigger:
  branches:
    include:
    - master

pool:
  vmImage: ubuntu-latest

variables:
  - group: docker-settings
  - name: app_name
    value : pr-$(System.PullRequest.PullRequestNumber)

stages:

# - stage: Build
#   jobs:
#   - job: Build
#     steps:
#     - template: templates/build.yml

- stage: dev
  jobs:
  - deployment: DeployDev
    displayName: deploy Web App Dev
    pool:
      vmImage: 'ubuntu-latest'
    # Creates an environment if it doesn't exist.
    environment: 's118-teacherpaymentsservice-development'

    strategy:
      # Default deployment strategy, more coming...
      runOnce:
        deploy:
          steps:
          - checkout: self
          - template: templates/test.yml #Run Release Template
            parameters :
              testparam : testing parameter passing



# - stage: test
#   jobs:
#   - deployment: DeployTest
#     displayName: deploy Web App Test
#     pool:
#       vmImage: 'ubuntu-latest'
#     # Creates an environment if it doesn't exist.
#     environment: 's118-teacherpaymentsservice-test'
#     strategy:
#       # Default deployment strategy, more coming...
#       runOnce:
#         deploy:
#           steps:
#           - checkout: self
#           - script: echo Test Environment

# - stage: prod
#   jobs:
#   - deployment: Deployprod
#     displayName: deploy Web App Prod
#     pool:
#       vmImage: 'ubuntu-latest'
#     # Creates an environment if it doesn't exist.
#     environment: 's118-teacherpaymentsservice-production'
#     strategy:
#       # Default deployment strategy, more coming...
#       runOnce:
#         deploy:
#           steps:
#           - checkout: self
#           - script: echo Production Environment

# - stage: Reviewapp
#   jobs:
#   - deployment: DeployReviewApp
#     displayName: deploy review app
#     pool:
#       vmImage: 'ubuntu-latest'
#     # Creates an environment if it doesn't exist.
#     environment: 's118-teacherpaymentsservice-development'
#     strategy:
#       # Default deployment strategy, more coming...
#       runOnce:
#         deploy:
#           steps:
#           - checkout: self
#           - script: echo Review App - Development Environment
