<% content_for(:page_title) { page_title("Claim #{@claim.reference} timeline") } %>

<% content_for :back_link do %>
  <%= govuk_back_link href: claims_backlink_path %>
<% end %>

<div class="govuk-grid-row">
  <%= render "admin/tasks/#{claim_summary_view}", claim: @claim, heading: @claim.reference %>
</div>

<div class="govuk-grid-row">
  <div class="govuk-tabs">
    <h2 class="govuk-tabs__title">Contents</h2>

    <%= render "admin/claims/tabs", claim: @claim %>

    <div class="govuk-tabs__panel">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">

          <h2 class="govuk-heading-l">Claim timeline</h2>

          <div class="hmcts-timeline">
            <% @events.each do |event| %>
              <div class="hmcts-timeline__item">
                <section>
                  <% description_locale_str = "admin.timeline.#{event.name}" %>
                  <%= simple_format(
                    "[#{l(event.created_at)}] #{t(description_locale_str)}",
                    { class: "govuk-body" },
                    { sanitize_options: { attributes: %w[class], tags: %w[span pre] } }
                  ) %>
                </section>

                <% if event.actor && event.actor.full_name.present? %>
                  <p class="hmcts-timeline__description">
                    by <%= event.actor.full_name %>
                  </p>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
